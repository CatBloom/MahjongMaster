<div class="result">
  <h2>{{ !formType ? '成績登録' : '成績修正' }}</h2>
  <section>
    <mat-checkbox [checked]="true" (change)="autoCalcPointCheck($event.checked)">自動計算</mat-checkbox>
  </section>
  <form [formGroup]="formGroup" autocomplete="off" class="formGroup">
    <ng-container *ngIf="playerList$ | async as playerList">
      <ng-container formArrayName="resultArray">
        <ng-container *ngFor="let result of resultArray.controls; let i = index" [formGroupName]="i">
          <div class="result-grid">
            <div class="result-grid__rank">
              <mat-form-field>
                <mat-label>ランク</mat-label>
                <mat-select formControlName="rank" [errorStateMatcher]="matcher">
                  <mat-option *ngFor="let _ of resultArray.controls; index as i" [value]="i + 1">
                    {{ i + 1 }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="result-grid__name">
              <mat-form-field>
                <mat-label>名前</mat-label>
                <mat-select formControlName="id" [errorStateMatcher]="matcher">
                  <mat-option *ngFor="let player of playerList" [value]="player.id">
                    {{ player.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="result-grid__point">
              <mat-form-field appearance="outline">
                <mat-label>点数</mat-label>
                <input matInput maxlength="6" formControlName="point" [errorStateMatcher]="matcher" appReplace />
              </mat-form-field>
            </div>
            <div class="result-grid__calc-point">
              <mat-form-field appearance="outline">
                <mat-label>順位点</mat-label>
                <input matInput formControlName="calcPoint" [errorStateMatcher]="matcher" appReplace />
              </mat-form-field>
            </div>
          </div>
        </ng-container>
      </ng-container>
    </ng-container>

    <div class="result-buttons">
      <button
        class="result-buttons__button"
        (click)="submitGame()"
        [disabled]="formGroup.invalid"
        mat-stroked-button
        color="accent"
      >
        {{ !formType ? '登録' : '更新' }}
      </button>
      <ng-container *ngIf="!formType">
        <button class="result-buttons__button" (click)="resetForm()" mat-stroked-button color="warn">リセット</button>
      </ng-container>
      <ng-container *ngIf="formType === 'put'">
        <button class="result-buttons__button" (click)="deleteGame()" mat-stroked-button color="warn">削除</button>
      </ng-container>
    </div>

    <div class="result-table">
      <app-table
        *ngIf="gameList$ | async as gameList"
        (rowClickEvent)="tableRowClick($event)"
        [columns]="tableColumns"
        [results]="gameList"
      ></app-table>
    </div>
  </form>
</div>
